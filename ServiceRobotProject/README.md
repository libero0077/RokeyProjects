# 서비스(음식배달) 로봇 및 관제 시스템 개발

### 데모영상



### 통계창 예시
- 하루 매출 및 메뉴별 판매량, 월 별 매출 및 메뉴별 판매량, 서빙 로봇의 배달 로그 등 다양한 통계를 확인할 수 있음

![Screenshot from 2024-12-23 18-00-48](https://github.com/user-attachments/assets/84ff5a77-18cf-440d-856b-5e9a222b06d0)


![Screenshot from 2024-12-23 18-01-01](https://github.com/user-attachments/assets/77440edb-eda0-475c-aade-5a9b0a693252)


![Screenshot from 2024-12-23 18-01-10](https://github.com/user-attachments/assets/7c4e9ed6-e674-4cbd-9c9e-23036a56e4b1)


![Screenshot from 2024-12-23 18-01-17](https://github.com/user-attachments/assets/aa8b11ec-215c-4095-aac0-c61f57cb4cf3)


![Screenshot from 2024-12-23 18-01-24](https://github.com/user-attachments/assets/2c705c0d-3c09-40cb-9cd9-be54d2c78e51)


![Screenshot from 2024-12-23 18-01-34](https://github.com/user-attachments/assets/ff6afc1a-5e6b-48f6-ae49-b79bd87ced3c)

## 목차

- [개요](#개요)
- [주요 기능](#주요-기능)
- [아키텍처](#아키텍처)
- [구성 요소](#구성-요소)
  - [컨베이어 시스템](#컨베이어-시스템)
  - [데이터베이스 관리자](#데이터베이스-관리자)
  - [불량 검출](#불량-검출)
  - [서버 관리자](#서버-관리자)
  - [검증기](#검증기)
  - [테스트 스크립트](#테스트-스크립트)
- [설치](#설치)
- [사용법](#사용법)
- [검증 알고리즘](#검증-알고리즘)
- [개선 계획](#개선-계획)
- [기여](#기여)
- [라이선스](#라이선스)
- [연락처](#연락처)
- [추가 참고 자료](#추가-참고-자료)

## 개요

**서비스(음식배달) 로봇 및 관제 시스템 개발**은 음식점 서빙 시스템 프로젝트는 현대 음식점의 워크플로우를 최적화하기 위해 주문 관리, 주방 운영, 음식 배달을 자동화한 통합 솔루션입니다. ROS (Robot Operating System)를 활용하여 구성 요소 간의 원활한 통신을 구현함으로써, 첨단 기술과 세심한 설계를 통해 효율성, 정확성 및 고객 만족도를 향상시킵니다.

## 주요 기능

- **실시간 불량 감지:** YOLO 알고리즘을 활용하여 Raspberry Pi Pico 부품의 불량을 실시간으로 감지합니다.
- **검출 성능 향상:** 호모그래피 변환, 부품 간 거리 계산, 신뢰도(confidence) 조절을 통해 검출 정확도를 향상시킵니다.
- **데이터베이스 관리:** SQLite를 사용하여 불량 검출 시각, 고유 ID, 불량 원인 등을 체계적으로 기록합니다.
- **통계 분석 및 시각화:** Gradio 기반의 웹 인터페이스를 통해 시계열별 불량 건수, 불량률, 불량 원인 등을 실시간으로 시각화합니다.
- **서버 통신 최적화:** 서버와의 효율적인 통신을 통해 검출 속도를 향상시키고 시스템의 전반적인 성능을 개선합니다.

## 아키텍처

시스템은 여러 상호 연결된 구성 요소로 구성되며, 각 구성 요소는 특정 기능을 담당하여 전체 시스템이 원활하게 동작하도록 합니다:

1. **컨베이어 시스템:** 컨베이어 벨트의 운영을 관리하고, 이미지 캡처 및 불량 검출을 제어합니다.
2. **데이터베이스 관리자:** SQLite 데이터베이스와의 모든 상호작용을 관리하며, 데이터베이스 초기화 및 CRUD(Create, Read, Update, Delete) 작업을 수행합니다.
3. **불량 검출:** YOLO 알고리즘을 사용하여 캡처된 이미지에서 불량을 감지하고, 검출 결과를 처리합니다.
4. **서버 관리자:** YOLO 추론 서버를 시작하고 관리하며, API 요청을 처리합니다.
5. **검증기:** 검출된 불량을 사전 정의된 기준에 따라 검증하여 제품의 품질을 평가합니다.
6. **테스트 스크립트:** 시스템의 성능과 정확도를 다양한 데이터셋을 통해 테스트하고 평가합니다.

## 구성 요소

### 컨베이어 시스템

- **파일:** `conveyor_system.py`
- **설명:** 컨베이어 벨트의 운영을 관리하고, 이미지 캡처 및 불량 검출 프로세스를 제어합니다.
- **주요 기능:**
  - 컨베이어 벨트에서 이미지 캡처
  - 불량 검출 프로세스 트리거
  - 데이터베이스 관리자와 통신하여 불량 기록 로그

### 데이터베이스 관리자

- **파일:** `db_manager.py`
- **설명:** SQLite 데이터베이스와의 모든 상호작용을 관리하며, 데이터베이스 초기화 및 CRUD 작업을 수행합니다.
- **주요 기능:**
  - 데이터베이스 초기화: 필요한 테이블(`product`) 생성 및 초기화
  - 데이터 삽입 및 업데이트: 새로운 불량 기록 삽입 및 기존 기록 업데이트

### 불량 검출

- **파일:** `defect_detection.py`
- **설명:** YOLO 알고리즘을 사용하여 이미지에서 불량을 실시간으로 감지하고, 검출 결과를 처리합니다.
- **주요 기능:**
  - 이미지 전처리 및 YOLO 추론 서버와 통신
  - 불량 감지 및 결과 주석 처리
  - 검증 알고리즘과 연계하여 품질 평가

### 서버 관리자

- **파일:** `server_manager.py`
- **설명:** YOLO 추론 서버를 시작하고 관리하며, API 요청을 처리합니다.
- **주요 기능:**
  - YOLO 추론 서버 시작 및 중지
  - 이미지 처리 API 요청 핸들링

### 검증기

- **파일:** `validator.py`
- **설명:** 검출된 불량을 사전 정의된 기준에 따라 검증하여 제품의 품질을 평가합니다.
- **주요 기능:**
  - 객체 감지 및 그룹화
  - 중심 좌표 계산 및 호모그래피 변환
  - 클래스 간 거리 계산 및 검증 조건 확인
  - 불량 판정 및 기록
  
#### 검증 알고리즘

**검증 알고리즘**은 불량 제품의 정확한 식별과 품질 관리를 위해 핵심적인 역할을 합니다. `validator.py`와 `defect_detection.py`에서 구현된 이 알고리즘은 다음과 같은 단계로 구성됩니다:

1. **객체 감지 및 그룹화:**
   - YOLO를 사용하여 이미지 내의 모든 객체를 감지하고, 각 객체의 클래스와 위치를 식별합니다.
   - 감지된 객체는 클래스별로 그룹화되어 관리됩니다.

2. **중심 좌표 계산:**
   - 각 객체의 바운딩 박스를 기반으로 중심 좌표를 계산합니다.
   - 이를 통해 객체 간의 상대적인 위치를 파악할 수 있습니다.

3. **호모그래피 변환:**
   - 호모그래피 변환을 통해 객체의 위치를 정규화된 좌표계로 변환합니다.
   - 이는 제품의 회전이나 기울어짐에 따른 영향을 최소화하여 정확한 위치 비교를 가능하게 합니다.

4. **클래스 간 거리 계산:**
   - 변환된 중심 좌표를 기반으로 서로 다른 클래스 간의 거리를 계산합니다.
   - 미리 정의된 거리 기준과 비교하여 각 클래스 간의 거리가 정상 범위 내에 있는지를 확인합니다.

5. **검증 조건 확인:**
   - **DHOLE(홀)의 수:** DHOLE 클래스의 객체가 정확히 4개인지 확인합니다. 4개 미만일 경우 불량으로 처리합니다.
   - **필수 클래스 확인:** BOOTSEL, OSCILLATOR, USB, CHIPSET 등 필수 클래스가 모두 존재하는지 확인합니다.
   - **거리 기준 충족 여부:** 각 클래스 간의 거리가 미리 정의된 기준 내에 있는지 확인합니다.

6. **불량 판정 및 기록:**
   - 검증 조건을 모두 충족하면 정상으로 판정하고, 그렇지 않으면 불량으로 기록합니다.
   - 불량 사유는 데이터베이스에 저장되어 추후 분석에 활용됩니다.

### 테스트 스크립트

- **파일:** `test_in_endpoint.py`, `test_in_localserver.py`
- **설명:** 시스템의 성능과 정확도를 다양한 데이터셋을 통해 테스트하고 평가합니다.
- **주요 기능:**
  - 테스트 이미지 전송 및 검출 결과 평가
  - 혼동 행렬 및 분류 보고서 생성

## 설치

### 필수 사항

- **Python 3.7 이상**
- **필수 라이브러리:**
  - `ultralytics`
  - `Pillow`
  - `gradio`
  - `pandas`
  - `opencv-python`
  - `sqlite3`
  - `math`
  - `itertools`
  - `requests`

### 설치 단계

1. **저장소 클론:**

    ```bash
    git clone https://github.com/libero0077/RokeyProjects/blob/main/ConveyorProject
    ```

2. **시스템 종속성 설치:**

    ```bash
    sudo apt update
    sudo apt install python3-pyqt5 python3-opencv sqlite3
    ```

3. **Python 패키지 설치:**

    ```bash
    pip install ultralytics Pillow gradio pandas requests
    ```

4. **데이터베이스 초기화:**

    데이터베이스 파일이 존재하지 않으면 `db_manager.py` 스크립트를 실행하여 자동으로 초기화.

    ```bash
    python db_manager.py
    ```

## 사용법

1. **컨베이어 시스템 실행:**

    ```bash
    python conveyor_system.py
    ```

2. **불량 검출 실행:**

    `conveyor_system.py` 스크립트는 이미지 캡처 및 불량 검출을 자동으로 처리합니다. YOLO 추론 서버가 실행 중이어야 합니다.

3. **웹 인터페이스 실행:**

    Gradio 기반의 웹 인터페이스를 실행하여 실시간 통계를 모니터링합니다.

    ```bash
    python defect_analysis_chart.py
    ```

4. **서버 관리자 실행 (선택 사항):**

    YOLO 추론 서버를 관리하려면 다음을 실행합니다.

    ```bash
    python server_manager.py
    ```

5. **테스트 스크립트 실행:**

    시스템의 성능과 정확도를 평가하려면 테스트 스크립트를 실행합니다.

    ```bash
    python test_in_endpoint.py
    python test_in_localserver.py
    ```

## 개선 계획

현재 시스템은 기본적인 불량 검출 및 통계 기능을 갖추고 있지만, 다음과 같은 개선을 통해 더욱 강력하고 효율적인 시스템으로 발전시킬 수 있습니다:

1. **모델 최적화:**
   - **경량화 YOLO 모델:** 실시간 처리 속도를 향상시키기 위해 YOLO 모델의 경량화 및 최적화를 진행합니다.
   - **하이퍼파라미터 튜닝:** 다양한 YOLO 버전과 하이퍼파라미터를 튜닝하여 검출 정확도를 높입니다.

2. **고급 통계 분석 및 예측:**
   - **머신러닝 도입:** 머신러닝 기법을 도입하여 불량 발생 패턴을 예측하고 사전 예방 조치를 취할 수 있도록 합니다.
   - **사용자 정의 대시보드:** 다양한 통계 지표를 시각화할 수 있는 사용자 정의 대시보드를 개발합니다.

4. **데이터 보안 및 접근 제어:**
   - **데이터베이스 보안 강화:** 데이터베이스 보안을 강화하고, 사용자 인증 및 권한 관리를 통해 데이터 접근을 제어합니다.
   - **실시간 데이터 암호화:** 실시간 데이터 암호화 및 백업 시스템을 도입하여 데이터의 무결성과 보안을 확보합니다.

5. **확장 가능한 아키텍처 구축:**
   - **마이크로서비스 아키텍처:** 마이크로서비스 아키텍처를 도입하여 각 구성 요소를 독립적으로 확장할 수 있도록 합니다.
   - **클라우드 인프라 활용:** 클라우드 인프라를 활용하여 시스템의 가용성과 확장성을 높입니다.

6. **사용자 경험 향상:**
   - **직관적 GUI 개선:** GUI 인터페이스를 더욱 직관적이고 사용자 친화적으로 개선합니다.
   - **모바일 지원:** 모바일 디바이스 지원을 통해 언제 어디서나 시스템을 모니터링할 수 있도록 합니다.

## 기여

[libero0077](https://github.com/libero0077) : 중앙 제어, DB 및 통계 페이지, 테스트 스크립트 작성, 전체 시스템 통합  
[Y6HYUK](https://github.com/Y6HYUK) : 데이터 증강 아이디어 모색, 데이터 수집 및 가설 검증  
[leesw1357](https://github.com/leesw1357) : 데이터 증강 아이디어 모색, 데이터 수집 및 가설 검증  
[juwon407](https://github.com/juwon407) : 분류 알고리즘 개발, 하드웨어 설계, 제작 및 설치  

## 라이선스

이 프로젝트는 [MIT 라이선스](LICENSE)를 따릅니다.

## 연락처

문의 사항이나 지원이 필요하시면 아래 연락처로 연락주세요:

- **이름:** Jaejun Ryu
- **GitHub:** [libero0077](https://github.com/libero0077)

---

## 추가 참고 자료

- [YOLO 공식 문서](https://pjreddie.com/darknet/yolo/)
- [Gradio 공식 문서](https://gradio.app/)
- [OpenCV 공식 문서](https://docs.opencv.org/)
- [SQLite 공식 문서](https://www.sqlite.org/docs.html)

